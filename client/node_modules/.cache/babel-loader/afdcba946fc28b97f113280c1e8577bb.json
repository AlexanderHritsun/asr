{"ast":null,"code":"var _jsxFileName = \"/Users/alexander_hritsun/WebstormProjects/asr/client/src/pages/Posts/AddPost.jsx\";\nimport React, { useContext, useEffect, useState } from \"react\";\nimport { useHistory } from 'react-router-dom';\nimport { Form, Button, Image } from \"react-bootstrap\";\nimport { useHttp } from \"../../hooks/http.hook\";\nimport { AuthContext } from \"../../context/AuthContext\";\nimport { FormErrors } from \"../../components/FormError\";\n\nfunction AddPost() {\n  const {\n    token\n  } = useContext(AuthContext);\n  const {\n    loading,\n    request,\n    error\n  } = useHttp();\n  const history = useHistory();\n  const [form, setForm] = useState({\n    title: '',\n    text: '',\n    files: []\n  });\n\n  const changeHandler = event => {\n    setForm({ ...form,\n      [event.target.name]: event.target.value\n    });\n  };\n\n  const toBase64 = file => new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsDataURL(file);\n\n    reader.onload = () => resolve(reader.result);\n\n    reader.onerror = error => reject(error);\n  });\n\n  const fileChangeHandler = async event => {\n    const files = [...event.target.files];\n    Promise.all(files.map(file => toBase64(file))).then(values => {\n      setForm({ ...form,\n        files: [...form.files, ...values]\n      });\n    });\n  };\n\n  const createHandler = async () => {\n    try {\n      const data = await request('/api/posts/create', 'POST', { ...form\n      }, {\n        Authorization: `Bearer ${token}`\n      });\n      history.push('/posts');\n    } catch (e) {}\n  };\n\n  const removeFileHandler = idx => {\n    const copy = [...form.files];\n    copy.splice(idx, 1);\n    setForm({ ...form,\n      files: copy\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(FormErrors, {\n    formErrors: error,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Form, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 46,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Form.Group, {\n    controlId: \"title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 21\n    }\n  }, \"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A\"), /*#__PURE__*/React.createElement(Form.Control, {\n    type: \"text\",\n    name: \"title\",\n    value: form.title,\n    onChange: changeHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(Form.Group, {\n    controlId: \"text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 21\n    }\n  }, \"\\u0420\\u0430\\u0441\\u0441\\u043A\\u0430\\u0436\\u0438\\u0442\\u0435 \\u043D\\u0430\\u043C \\u0441\\u0432\\u043E\\u044E \\u0438\\u0441\\u0442\\u043E\\u0440\\u0438\\u044E\"), /*#__PURE__*/React.createElement(Form.Control, {\n    as: \"textarea\",\n    rows: \"7\",\n    name: \"text\",\n    value: form.text,\n    onChange: changeHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(Form.File, {\n    multiple: true,\n    id: \"custom-file-translate-scss\",\n    \"data-browse\": \"\\u0412\\u044B\\u0431\\u0440\\u0430\\u0442\\u044C \\u0444\\u0430\\u0439\\u043B\",\n    label: \"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u0435 \\u0441\\u0432\\u043E\\u0438 \\u0444\\u0430\\u0439\\u043B\\u044B\",\n    lang: \"ru\",\n    custom: true,\n    name: \"file\",\n    accept: \"image/*\",\n    onChange: fileChangeHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 17\n    }\n  }), !!form.files.length && /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      marginBottom: 15\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 21\n    }\n  }, form.files.map((file, i) => /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      position: 'relative'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Image, {\n    src: file,\n    rounded: true,\n    style: {\n      maxWidth: 100,\n      maxHeight: 100,\n      margin: 10,\n      objectFit: 'cover'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 33\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      position: 'absolute',\n      top: 10,\n      right: 10,\n      width: 20,\n      height: 20,\n      background: 'rgba(0,0,0,0.5)',\n      borderRadius: 5,\n      fontSize: 12,\n      color: '#fff',\n      textAlign: 'center'\n    },\n    onClick: () => removeFileHandler(i),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 33\n    }\n  }, \"X\")))), /*#__PURE__*/React.createElement(Button, {\n    style: {\n      marginTop: 10\n    },\n    variant: \"secondary\",\n    className: \"mr-m\",\n    type: \"button\",\n    onClick: createHandler,\n    disabled: loading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 17\n    }\n  }, \"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u043F\\u043E\\u0441\\u0442\")));\n}\n\nexport default AddPost;","map":{"version":3,"sources":["/Users/alexander_hritsun/WebstormProjects/asr/client/src/pages/Posts/AddPost.jsx"],"names":["React","useContext","useEffect","useState","useHistory","Form","Button","Image","useHttp","AuthContext","FormErrors","AddPost","token","loading","request","error","history","form","setForm","title","text","files","changeHandler","event","target","name","value","toBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","fileChangeHandler","all","map","then","values","createHandler","data","Authorization","push","e","removeFileHandler","idx","copy","splice","length","display","justifyContent","marginBottom","i","position","maxWidth","maxHeight","margin","objectFit","top","right","width","height","background","borderRadius","fontSize","color","textAlign","marginTop"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from \"react\";\nimport { useHistory } from 'react-router-dom'\nimport { Form, Button, Image } from \"react-bootstrap\";\nimport { useHttp } from \"../../hooks/http.hook\";\nimport { AuthContext } from \"../../context/AuthContext\";\nimport { FormErrors } from \"../../components/FormError\";\n\nfunction AddPost() {\n    const { token } = useContext(AuthContext)\n    const { loading, request, error } = useHttp();\n    const history = useHistory();\n    const [form, setForm] = useState({\n        title: '', text: '', files: []\n    })\n    const changeHandler = event => {\n        setForm({ ...form, [event.target.name]: event.target.value })\n    }\n    const toBase64 = file => new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.readAsDataURL(file);\n        reader.onload = () => resolve(reader.result);\n        reader.onerror = error => reject(error);\n    });\n    const fileChangeHandler = async (event) => {\n        const files = [...event.target.files];\n        Promise.all(files.map(file => toBase64(file))).then((values) => {\n            setForm({ ...form, files: [...form.files, ...values] });\n        });\n    }\n    const createHandler = async () => {\n        try {\n            const data = await request('/api/posts/create', 'POST', { ...form }, {\n                Authorization: `Bearer ${token}`\n            });\n            history.push('/posts');\n        } catch (e) { }\n    }\n    const removeFileHandler = (idx) => {\n        const copy = [...form.files];\n        copy.splice(idx, 1);\n        setForm({ ...form, files: copy });\n    }\n    return (\n        <div className=\"form\">\n            <FormErrors formErrors={error}/>\n            <Form>\n                <Form.Group controlId=\"title\">\n                    <Form.Label>Заголовок</Form.Label>\n                    <Form.Control\n                        type=\"text\"\n                        name=\"title\"\n                        value={form.title}\n                        onChange={changeHandler}\n                    />\n                </Form.Group>\n\n                <Form.Group controlId=\"text\">\n                    <Form.Label>Расскажите нам свою историю</Form.Label>\n                    <Form.Control\n                        as=\"textarea\"\n                        rows=\"7\"\n                        name=\"text\"\n                        value={form.text}\n                        onChange={changeHandler}\n                    />\n                </Form.Group>\n\n                <Form.File\n                    multiple\n                    id=\"custom-file-translate-scss\"\n                    data-browse=\"Выбрать файл\"\n                    label=\"Загрузите свои файлы\"\n                    lang=\"ru\"\n                    custom\n                    name=\"file\"\n                    accept=\"image/*\"\n                    onChange={fileChangeHandler}\n                />\n\n                {!!form.files.length &&\n                    <div\n                        style={{\n                            display: 'flex',\n                            justifyContent: 'center',\n                            marginBottom: 15\n                        }}>\n                        {form.files.map((file, i) => (\n                            <div style={{ position: 'relative' }}>\n                                <Image src={file} rounded style={{\n                                    maxWidth: 100,\n                                    maxHeight: 100,\n                                    margin: 10,\n                                    objectFit: 'cover'\n                                }} />\n                                <div style={{ \n                                    position: 'absolute',\n                                    top: 10,\n                                    right: 10,\n                                    width: 20,\n                                    height: 20,\n                                    background: 'rgba(0,0,0,0.5)',\n                                    borderRadius: 5,\n                                    fontSize: 12,\n                                    color: '#fff',\n                                    textAlign: 'center'\n                                }}\n                                onClick={() => removeFileHandler(i)}>X</div>\n                            </div>\n                        ))}\n                    </div>}\n\n                <Button\n                    style={{ marginTop: 10 }}\n                    variant=\"secondary\"\n                    className='mr-m'\n                    type=\"button\"\n                    onClick={createHandler}\n                    disabled={loading}\n                >\n                    Создать пост\n                </Button>\n            </Form>\n        </div>\n    )\n}\n\nexport default AddPost"]},"metadata":{},"sourceType":"module"}